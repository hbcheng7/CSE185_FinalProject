#This uses the tag_directory input directly without calling UNIX commands or using the HOMER python library

import os
import gzip

def make_ucsc_file(tag_directory, output_file):
    # Check if the tag directory exists
    if not os.path.isdir(tag_directory):
        print("Tag directory does not exist.")
        return

    # Check if the output file ends with '.ucsc.bedGraph.gz'
    if not output_file.endswith('.ucsc.bedGraph.gz'):
        print("Output file name should end with '.ucsc.bedGraph.gz'.")
        return

    # Collect the tag directory files
    tag_files = [f for f in os.listdir(tag_directory) if f.endswith('.tags.tsv')]

    if not tag_files:
        print("No tag files found in the tag directory.")
        return

    # Open the output file for writing
    with gzip.open(output_file, 'wt') as output:
        # Iterate over each tag file
        for tag_file in tag_files:
            tag_file_path = os.path.join(tag_directory, tag_file)

            # Read the tag file and write to the output file
            with open(tag_file_path, 'r') as tag_file:
                for line in tag_file:
                    columns = line.strip().split('\t')
                    chromosome = columns[0]
                    start = columns[1]
                    end = columns[2]
                    count = columns[5]
                    output.write(f"{chromosome}\t{start}\t{end}\t{count}\n")

    print("UCSC file created successfully.")

# Usage example
tag_directory_path = '/path/to/tag_directory'
output_file_path = '/path/to/output_file.ucsc.bedGraph.gz'
make_ucsc_file(tag_directory_path, output_file_path)
